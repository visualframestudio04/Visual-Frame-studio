<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Center | Visual Frame</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #050505; 
            color: #ffffff;
            overflow-x: hidden;
        }

        .glass { 
            background: rgba(255, 255, 255, 0.02); 
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 28px;
        }

        .gradient-stat { 
            background: linear-gradient(135deg, #121212 0%, #080808 100%); 
            border: 1px solid rgba(59, 130, 246, 0.15); 
        }
        
        .tab-btn {
            transition: all 0.3s ease;
            color: #71717a;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.1em;
            padding: 10px 24px;
            border-radius: 14px;
        }

        .tab-btn.active {
            color: #ffffff;
            background: #3b82f6;
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.2);
        }

        .status-pill {
            background: #111;
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: #fff;
            font-size: 10px;
            padding: 6px 12px;
            border-radius: 10px;
            outline: none;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-action {
            width: 38px; height: 38px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-action:hover { transform: translateY(-3px); background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .btn-delete:hover { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        .modal-overlay {
            position: fixed; inset: 0; z-index: 100;
            display: none; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(12px);
        }

        .toast {
            position: fixed; bottom: 30px; right: 30px;
            padding: 16px 28px; border-radius: 18px;
            background: #ffffff; color: #000000; font-weight: 800;
            z-index: 1000; display: none;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            animation: slideIn 0.4s ease;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 1px;
        }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
        
        .row-updating { opacity: 0.4; pointer-events: none; filter: grayscale(1); }

        .badge-new { background: rgba(59, 130, 246, 0.1); color: #3b82f6; padding: 2px 8px; border-radius: 6px; font-size: 9px; font-weight: 800; }
        
        /* Matching Admin Footer Style */
        .admin-footer {
            background: linear-gradient(to top, #000, #050505);
            border-top: 1px solid rgba(255,255,255,0.05);
        }
    </style>
</head>
<body class="p-4 md:p-12">

    <!-- Toast Success Notification -->
    <div id="toast" class="toast">Data Synced Successfully</div>

    <div class="max-w-7xl mx-auto min-h-screen">
        <!-- Header Section -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-14 gap-8">
            <div class="text-center md:text-left">
                <h1 class="text-3xl md:text-5xl font-black uppercase tracking-tighter italic">VISUAL <span class="text-blue-500">FRAME</span> STUDIO</h1>
                <p class="text-zinc-500 text-[10px] font-black uppercase tracking-[0.4em] mt-2">Production Management Suite</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden sm:flex bg-zinc-900/50 px-5 py-2.5 border border-white/5 rounded-full text-[9px] font-black uppercase tracking-widest text-green-500 items-center">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-ping"></span> Live Cloud Connected
                </div>
                <button onclick="fetchAllData()" class="bg-blue-600 p-4 rounded-2xl hover:bg-blue-500 transition shadow-lg shadow-blue-600/20">
                    <i id="syncIcon" class="fas fa-sync-alt text-white"></i>
                </button>
            </div>
        </header>

        <!-- Stats Overview -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-14">
            <div class="gradient-stat p-8 rounded-[2.5rem]">
                <p class="text-zinc-500 text-[10px] font-black uppercase mb-2">Inquiry Stream</p>
                <h3 class="text-5xl font-black italic tracking-tighter" id="projCount">0</h3>
            </div>
            <div class="gradient-stat p-8 rounded-[2.5rem]">
                <p class="text-zinc-500 text-[10px] font-black uppercase mb-2">Talent Pool</p>
                <h3 class="text-5xl font-black italic tracking-tighter" id="appCount">0</h3>
            </div>
            <div class="gradient-stat p-8 rounded-[2.5rem] border-blue-500/40">
                <p class="text-blue-500 text-[10px] font-black uppercase mb-2">Ongoing Edits</p>
                <h3 class="text-5xl font-black italic tracking-tighter" id="activeCount">0</h3>
            </div>
            <div class="glass p-8 rounded-[2.5rem] flex flex-col justify-center cursor-pointer hover:bg-white hover:text-black transition duration-500 group" onclick="window.open('https://docs.google.com/spreadsheets/d/1vM_Uq_P4j8oFm0z-nN8P5lK3P4_o1u6vK-DkG3C1uS8/edit', '_blank')">
                <p class="text-zinc-500 text-[10px] font-black uppercase mb-2 group-hover:text-black/50">Raw Database</p>
                <h3 class="text-xs font-black uppercase tracking-widest flex items-center">Open Sheets <i class="fas fa-external-link-alt ml-2 text-[10px]"></i></h3>
            </div>
        </div>

        <!-- Navigation System -->
        <div class="flex p-1.5 glass w-fit mb-10 gap-1.5 rounded-2xl">
            <button onclick="switchTab('projects')" id="btn-projects" class="tab-btn active">Project Leads</button>
            <button onclick="switchTab('careers')" id="btn-careers" class="tab-btn">Recruitment</button>
        </div>

        <!-- DATA TABLES -->
        <div id="projectsContent" class="glass overflow-hidden min-h-[500px] shadow-2xl mb-32">
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm border-collapse">
                    <thead class="bg-white/5 text-zinc-500 text-[10px] font-black uppercase tracking-[0.15em]">
                        <tr>
                            <th class="p-7">Client & ID</th>
                            <th class="p-7">Team Assignment</th>
                            <th class="p-7">Workflow Status</th>
                            <th class="p-7">Delivery</th>
                            <th class="p-7 text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="projectsBody" class="divide-y divide-white/[0.03]">
                        <tr><td colspan="5" class="p-32 text-center"><i class="fas fa-circle-notch fa-spin text-4xl text-blue-500 opacity-20"></i></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="careersContent" class="hidden glass overflow-hidden min-h-[500px] mb-32">
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-white/5 text-zinc-500 text-[10px] font-black uppercase tracking-widest">
                        <tr>
                            <th class="p-7">Candidate</th>
                            <th class="p-7">Role</th>
                            <th class="p-7">Hiring Phase</th>
                            <th class="p-7">Portfolio</th>
                            <th class="p-7 text-right">HR Controls</th>
                        </tr>
                    </thead>
                    <tbody id="careersBody" class="divide-y divide-white/[0.03]"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL: DELIVERY SYSTEM -->
    <div id="deliveryModal" class="modal-overlay">
        <div class="glass p-12 w-full max-w-md shadow-2xl border-blue-500/30">
            <h3 class="text-3xl font-black italic uppercase tracking-tighter mb-1">Final Delivery</h3>
            <p id="modalClient" class="text-[10px] text-blue-500 font-black uppercase tracking-widest mb-10">Client Name</p>
            <div class="space-y-8">
                <div class="space-y-2">
                    <label class="text-[9px] font-black uppercase text-zinc-500 ml-1">Asset Link (Google Drive/Dropbox)</label>
                    <input type="url" id="driveInput" class="w-full bg-black border border-white/10 p-5 rounded-2xl outline-none focus:border-blue-500 text-xs transition placeholder:opacity-30" placeholder="https://drive.google.com/...">
                </div>
                <div class="flex gap-4">
                    <button id="deliverSubmitBtn" onclick="submitProjectDelivery()" class="flex-1 bg-white text-black py-5 rounded-2xl text-[11px] font-black uppercase tracking-widest hover:bg-blue-500 hover:text-white transition-all duration-500">Deliver Assets & Notify</button>
                    <button onclick="closeModal('deliveryModal')" class="px-8 py-5 text-zinc-500 text-[11px] font-black uppercase tracking-widest">Exit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: DELETE CONFIRMATION -->
    <div id="deleteModal" class="modal-overlay">
        <div class="glass p-12 w-full max-w-sm text-center border-red-500/20">
            <div class="w-20 h-20 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6 text-2xl border border-red-500/20">
                <i class="fas fa-trash-alt"></i>
            </div>
            <h3 class="text-2xl font-black uppercase italic mb-2">Delete Permanently?</h3>
            <p class="text-zinc-500 text-xs mb-10 leading-relaxed">Aa entry sheet mathi hamesha mate delete thai jashe. Tame kharekhar delete karva mangu chho?</p>
            <div class="flex gap-4">
                <button id="confirmDeleteBtn" class="flex-1 bg-red-600 text-white py-5 rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-lg shadow-red-600/20">Yes, Delete</button>
                <button onclick="closeModal('deleteModal')" class="flex-1 bg-zinc-900 text-zinc-400 py-5 rounded-2xl text-[11px] font-black uppercase tracking-widest">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Footer: Synced with Admin Theme -->
    <footer class="admin-footer py-20 px-6 mt-20">
        <div class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-16">
                <!-- Brand Column -->
                <div class="md:col-span-1">
                    <div class="text-3xl font-black tracking-tighter uppercase italic mb-6">VISUAL <span class="text-blue-500">FRAME</span></div>
                    <p class="text-zinc-500 text-[11px] leading-relaxed font-bold uppercase tracking-widest max-w-[200px]">
                        Cinematic vision and production management at scale.
                    </p>
                </div>
                
                <!-- Quick Navigation -->
                <div>
                    <h5 class="text-zinc-300 text-[10px] font-black uppercase tracking-[0.2em] mb-8">Navigation</h5>
                    <ul class="space-y-4">
                        <li><a href="index.html" class="text-zinc-500 hover:text-white text-[11px] font-bold uppercase tracking-widest transition">Home</a></li>
                        <li><a href="portfolio.html" class="text-zinc-500 hover:text-white text-[11px] font-bold uppercase tracking-widest transition">Portfolio</a></li>
                        <li><a href="careers.html" class="text-zinc-500 hover:text-white text-[11px] font-bold uppercase tracking-widest transition">Careers</a></li>
                    </ul>
                </div>

                <!-- Admin Tools -->
                <div>
                    <h5 class="text-zinc-300 text-[10px] font-black uppercase tracking-[0.2em] mb-8">Management</h5>
                    <ul class="space-y-4">
                        <li><a href="contact.html" class="text-zinc-500 hover:text-white text-[11px] font-bold uppercase tracking-widest transition">Inquiries</a></li>
                        <li><a href="admin.html" class="text-blue-500 hover:text-blue-400 text-[11px] font-black uppercase tracking-widest transition flex items-center gap-2">
                            <span class="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse"></span> Terminal Dashboard
                        </a></li>
                    </ul>
                </div>

                <!-- Social Presence -->
                <div>
                    <h5 class="text-zinc-300 text-[10px] font-black uppercase tracking-[0.2em] mb-8">Follow</h5>
                    <div class="flex gap-5 text-xl">
                        <a href="https://instagram.com/visualframestudio" target="_blank" class="text-zinc-500 hover:text-white transition"><i class="fab fa-instagram"></i></a>
                        <a href="https://youtube.com/@visualframestudio" target="_blank" class="text-zinc-500 hover:text-white transition"><i class="fab fa-youtube"></i></a>
                        <a href="https://linkedin.com/company/Visual Frame.studio" target="_blank" class="text-zinc-500 hover:text-white transition"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="pt-10 border-t border-white/5 flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="text-zinc-700 text-[9px] font-black uppercase tracking-[0.3em] italic">
                    &copy; 2026 VISUAL FRAME STUDIO / CORE ENGINE v4.0.2
                </div>
                <div class="flex items-center gap-3">
                    <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                    <span class="text-zinc-700 text-[9px] font-black uppercase tracking-widest">System Operational</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const CONTACT_API = "https://script.google.com/macros/s/AKfycby29qhFzaEVDdPq2UaX0qtUVND3Xs6u_GSnsvVaR7EGyQ4wX29hNNXXrY2I_Ii5r2EQbA/exec"; 
        const CAREERS_API = "https://script.google.com/macros/s/AKfycbzlPCCK_ygPM9S2p5XYVb_UdnGL8ZAWv3gZVZsnqSrt9ZoA2aHIKWq2YkDzmrT1XuXJRA/exec";

        let activeTarget = null;
        const studioTeam = ["Not Assigned", "Pranav Garasiya", "Parth", "Rutu", "Rupal"];

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 4000);
        }

        async function fetchAllData() {
            const icon = document.getElementById('syncIcon');
            icon.classList.add('fa-spin');
            try {
                const [pRes, cRes] = await Promise.all([
                    fetch(`${CONTACT_API}?cache=${Date.now()}`),
                    fetch(`${CAREERS_API}?cache=${Date.now()}`)
                ]);
                
                const pData = await pRes.json();
                const cData = await cRes.json();
                
                renderProjects(pData);
                renderCareers(cData);
                
                document.getElementById('projCount').innerText = pData.length;
                document.getElementById('appCount').innerText = cData.length;
                document.getElementById('activeCount').innerText = pData.filter(i => i.Status === 'In Progress').length;
                
                showToast("Live Database Synced");
            } catch (e) { 
                console.error(e);
                showToast("Connection Error! Refresh or Check Script Access"); 
            }
            finally { icon.classList.remove('fa-spin'); }
        }

        function renderProjects(data) {
            const body = document.getElementById('projectsBody');
            body.innerHTML = data.reverse().map(item => {
                const uniqueID = item.UID || item.uid || item.Timestamp;
                const rowId = `row-proj-${uniqueID}`;

                return `
                <tr class="hover:bg-white/[0.02] transition" id="${rowId}">
                    <td class="p-7">
                        <div class="font-extrabold text-white text-base">${item.name || 'Anonymous'}</div>
                        <div class="flex items-center gap-2 mt-1.5">
                            <span class="badge-new">${uniqueID}</span>
                            <span class="text-[9px] text-zinc-600 font-bold uppercase">${item.service || '-'}</span>
                        </div>
                    </td>
                    <td class="p-7">
                        <select onchange="updateBackend('contact', '${uniqueID}', {assigned: this.value})" class="status-pill text-blue-400 border-blue-500/20 bg-blue-500/5">
                            ${studioTeam.map(m => `<option value="${m}" ${item['Assigned To'] === m ? 'selected' : ''}>${m}</option>`).join('')}
                        </select>
                    </td>
                    <td class="p-7">
                        <select onchange="updateBackend('contact', '${uniqueID}', {status: this.value})" class="status-pill">
                            <option value="Pending" ${item.Status === 'Pending' ? 'selected' : ''}>Pending</option>
                            <option value="In Progress" ${item.Status === 'In Progress' ? 'selected' : ''}>Active</option>
                            <option value="Completed" ${item.Status === 'Completed' ? 'selected' : ''}>Finished</option>
                        </select>
                    </td>
                    <td class="p-7">
                        ${item['Drive Link'] ? `<a href="${item['Drive Link']}" target="_blank" class="text-blue-500 text-[10px] font-black uppercase underline tracking-tighter">View Work Link</a>` : `<span class="text-zinc-800 text-[10px] font-black uppercase">Not Ready</span>`}
                    </td>
                    <td class="p-7 text-right">
                        <div class="flex justify-end gap-3">
                            <button onclick="openDeliveryModal('${uniqueID}', '${item.name}')" class="btn-action" title="Deliver"><i class="fas fa-paper-plane text-xs"></i></button>
                            <a href="https://wa.me/${(item.whatsapp || '').toString().replace(/\D/g,'')}" target="_blank" class="btn-action text-green-500"><i class="fab fa-whatsapp"></i></a>
                            <button onclick="confirmDelete('contact', '${uniqueID}')" class="btn-action btn-delete text-zinc-600"><i class="fas fa-trash text-xs"></i></button>
                        </div>
                    </td>
                </tr>
            `}).join('');
        }

        function renderCareers(data) {
            const body = document.getElementById('careersBody');
            body.innerHTML = data.reverse().map(item => {
                const uniqueID = item.UID || item.uid || item.Timestamp;
                const rowId = `row-care-${uniqueID}`;

                return `
                <tr class="hover:bg-white/[0.02] transition" id="${rowId}">
                    <td class="p-7">
                        <div class="font-extrabold text-white text-base">${item.fullName || 'N/A'}</div>
                        <div class="text-[9px] text-zinc-500 font-bold uppercase mt-1 italic">${item.email || '-'}</div>
                    </td>
                    <td class="p-7 text-[10px] font-black uppercase text-purple-400 tracking-widest">${item.position || '-'}</td>
                    <td class="p-7">
                         <select onchange="updateBackend('career', '${uniqueID}', {status: this.value})" class="status-pill">
                            <option value="Pending" ${item.Status === 'Pending' ? 'selected' : ''}>Applied</option>
                            <option value="Shortlisted" ${item.Status === 'Shortlisted' ? 'selected' : ''}>Review</option>
                            <option value="Hired" ${item.Status === 'Hired' ? 'selected' : ''}>Hired</option>
                            <option value="Rejected" ${item.Status === 'Rejected' ? 'selected' : ''}>Pass</option>
                        </select>
                    </td>
                    <td class="p-7"><a href="${item.portfolio}" target="_blank" class="text-zinc-600 hover:text-white transition"><i class="fas fa-link text-xs"></i> Portfolio</a></td>
                    <td class="p-7 text-right">
                        <div class="flex justify-end gap-3">
                             <a href="https://wa.me/${(item.whatsapp || '').toString().replace(/\D/g,'')}" target="_blank" class="btn-action text-green-500"><i class="fab fa-whatsapp text-lg"></i></a>
                             <button onclick="confirmDelete('career', '${uniqueID}')" class="btn-action btn-delete text-zinc-600"><i class="fas fa-trash text-xs"></i></button>
                        </div>
                    </td>
                </tr>
            `}).join('');
        }

        async function updateBackend(type, uid, obj) {
            const api = type === 'contact' ? CONTACT_API : CAREERS_API;
            const prefix = type === 'contact' ? 'proj' : 'care';
            const row = document.getElementById(`row-${prefix}-${uid}`);
            if(row) row.classList.add('row-updating');

            const fd = new FormData();
            fd.append('action', 'updateData');
            fd.append('uid', uid); 
            if(obj.status) fd.append('status', obj.status);
            if(obj.driveLink) fd.append('driveLink', obj.driveLink);
            if(obj.assigned) fd.append('assignedTo', obj.assigned);
            
            try {
                const response = await fetch(api, { method: 'POST', body: fd });
                const text = await response.text();
                showToast("Sync Successful: Data Saved");
                fetchAllData();
            } catch (error) {
                console.error(error);
                showToast("Sync Failed! Check connection");
                fetchAllData();
            } finally {
                if(row) row.classList.remove('row-updating');
            }
        }

        function confirmDelete(type, uid) {
            activeTarget = { type, uid };
            document.getElementById('deleteModal').style.display = 'flex';
        }

        document.getElementById('confirmDeleteBtn').onclick = async () => {
            const btn = document.getElementById('confirmDeleteBtn');
            const originalText = btn.innerText;
            btn.innerText = "Processing...";
            btn.disabled = true;

            const api = activeTarget.type === 'contact' ? CONTACT_API : CAREERS_API;
            const fd = new FormData();
            fd.append('action', 'deleteData');
            fd.append('uid', activeTarget.uid);
            
            try {
                await fetch(api, { method: 'POST', body: fd });
                closeModal('deleteModal');
                showToast("Record Removed");
                fetchAllData();
            } catch (e) {
                showToast("Delete Failed");
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        function openDeliveryModal(uid, name) {
            activeTarget = { uid, name };
            document.getElementById('modalClient').innerText = name;
            document.getElementById('deliveryModal').style.display = 'flex';
        }

        async function submitProjectDelivery() {
            const link = document.getElementById('driveInput').value;
            const btn = document.getElementById('deliverSubmitBtn');
            if(!link) return alert("Please paste the Google Drive link!");
            
            btn.innerText = "Syncing & Mailing...";
            btn.disabled = true;

            try {
                await updateBackend('contact', activeTarget.uid, { status: 'Completed', driveLink: link });
                showToast("Assets Delivered & Mail Sent");
                closeModal('deliveryModal');
                document.getElementById('driveInput').value = "";
                fetchAllData();
            } catch (e) {
                showToast("Delivery Failed");
            } finally {
                btn.innerText = "Deliver Assets & Notify";
                btn.disabled = false;
            }
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        function switchTab(tab) {
            document.getElementById('projectsContent').classList.toggle('hidden', tab !== 'projects');
            document.getElementById('careersContent').classList.toggle('hidden', tab !== 'careers');
            document.getElementById('btn-projects').classList.toggle('active', tab === 'projects');
            document.getElementById('btn-careers').classList.toggle('active', tab === 'careers');
        }

        window.onload = fetchAllData;
    </script>
</body>
</html>